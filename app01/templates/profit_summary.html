{% extends 'layout.html' %}
{% load static %} <!-- 确保加载了 static 模板标签 -->
{% block content %}
    <div class="container-fluid">

        <!-- 日期筛选表单 -->
        <form method="get" class="form-inline" style="margin-bottom: 20px;">
            <label for="start_date">开始日期:</label>
            <input type="date" id="start_date" name="start_date" value="{{ start_date }}" class="form-control">
            <label for="end_date" style="margin-left: 10px;">结束日期:</label>
            <input type="date" id="end_date" name="end_date" value="{{ end_date }}" class="form-control">
            <button type="submit" class="btn btn-primary" style="margin-left: 10px;">查询</button>
        </form>

        <div class="panel panel-default">
            <div class="panel-heading">
                <span class="glyphicon glyphicon-th-list" aria-hidden="true"></span>
                利润汇总表
            </div>

            <div class="table-responsive">
                <table id="profit_summary_table" class="table table-striped table-bordered table-hover">
                    <thead>
                    <tr>
                        <th>批次</th>
                        <th>工时费</th>
                        <th>农资费用</th>
                        <th>散工工时</th>
                        <th>浇水打杂费用</th>
                        <th>材料费</th>
                        <th>管理费</th>
                        <th>生活费</th>
                        <th>水电费</th>
                        <th>报销费用</th>
                        <th>其他费用</th>
                        <th>地租</th>
                        <th>折旧摊销</th>
                        <th>其他资产</th>
                        <th>农家肥</th>
                        <th>有机肥</th>
                        <th>草莓土</th>
                        <th>出勤奖金</th>
                        <th>服务费</th>
                        <th>地租大棚摊销</th>
                        <th>燃油费</th>
                        <th>维修费</th>
                        <th>销售费</th>
                        <th>销售收入</th>
                        <th>总成本</th>
                        <th>利润</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for item in queryset %}
                        <tr>
                            <td>{{ item.批次 }}</td>
                            <td>{{ item.工时费 }}</td>
                            <td>{{ item.农资费用 }}</td>
                            <td>{{ item.散工工时 }}</td>
                            <td>{{ item.浇水打杂费用 }}</td>
                            <td>{{ item.材料费 }}</td>
                            <td>{{ item.管理费 }}</td>
                            <td>{{ item.生活费 }}</td>
                            <td>{{ item.水电费 }}</td>
                            <td>{{ item.报销费用 }}</td>
                            <td>{{ item.其他费用 }}</td>
                            <td>{{ item.地租 }}</td>
                            <td>{{ item.折旧摊销 }}</td>
                            <td>{{ item.其他资产 }}</td>
                            <td>{{ item.农家肥 }}</td>
                            <td>{{ item.有机肥 }}</td>
                            <td>{{ item.草莓土 }}</td>
                            <td>{{ item.出勤奖金 }}</td>
                            <td>{{ item.服务费 }}</td>
                            <td>{{ item.地租大棚摊销 }}</td>
                            <td>{{ item.燃油费 }}</td>
                            <td>{{ item.维修费 }}</td>
                            <td>{{ item.销售费 }}</td>
                            <td>{{ item.销售收入 }}</td>
                            <td>{{ item.总成本 }}</td>
                            <td>{{ item.利润 }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <style>
        .table-responsive {
            width: 100%;
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            white-space: nowrap; /* 防止换行 */
        }
        th {
            background-color: #f2f2f2;
            line-height: 1.2; /* 调整行高 */
        }
    </style>

    <!-- 加载 DataTables 和相关的导出功能 -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.flash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.print.min.js"></script>

    <script>
        $(document).ready(function() {
            $('#profit_summary_table').DataTable({
                dom: 'Bfrtip',
                buttons: [
                    'copy', 'csv', 'excel', 'pdf', 'print'
                ],
                paging: true,
                searching: true,
                ordering: true
            });
        });
    </script>

{% endblock %}
